{% extends 'FMRFactureBundle::layout.html.twig' %}{% block content -%}
<div class="page-header">
		<h1>Facture N° {{ entity.id }} {% if entity.client %} pour {{ entity.client }}{% endif %}</h1>
		<div style="text-align:right;">
			<a class="btn btn-primary" href="{{ path('facture_edit', { 'id': entity.id }) }}">
				Editer
			</a>
		</div>
	</div>

<div class="row-fluid">
		<h3>Informations sur la facture : </h3>
		<div class="row-fluid">
			<div class="span6">
				<p><strong>Référence Client : </strong>{{ entity.referenceClient }}</p>
				<p><strong>Statut : </strong>{{ entity.statut }}</p>
				<form action="{{ path('facture_statut', {'id':entity.id}) }}" method="post" {{ form_enctype(formStatut) }}>
					<input type="hidden" name="_method" value="PUT" />
					{{ form_widget(formStatut) }}
			        <button type="submit" class="btn btn-primary">Changer le statut</button>
    			</form>
				
			</div>
			<div class="span6">
				<p><strong>Date Cr&eacute;ation</strong>
				{{ entity.dateCreation|date('d.m.Y H:i') }}</p>
				
				{% if entity.dateImpression %}
					<p><strong>Date d'impression</strong>
						{{ entity.dateImpression|date('d.m.Y H:i') }}
					</p>
				{% endif %}
				{% if entity.datePayement %}
					<p><strong>Date du payement</strong>
						{{ entity.datePayement|date('d.m.Y H:i') }}
					</p>
				{% endif %}
				<p><strong>Rabais</strong>
					{{entity.rabais*100 }}%
				</p>
				<p><strong>TVA</strong>
					{{ entity.tVA*100 }}%
				</p>
				{% if entity.chantier %}
					<h4>Chantier :</h4>
					<a class="btn btn-info" href="{{ path('chantier_show', { 'id': entity.chantier.id }) }}">Voir le chantier</a>
					{% if entity.chantier.offre %}
						<h4>Offre :</h4>
						<a class="btn btn-info" href="{{ path('offre_show', { 'id': entity.chantier.offre.id }) }}">Voir l'offre</a>
					{% endif %}
				{% endif %}
					
				
			</div>
		</div>

		<hr>
		{% if entity.client %}
			<h3>Informations sur le client :</h3>
			<p><strong>Client : </strong><a href="{{ path('client_show', { 'id': entity.client.id }) }}">{{ entity.client }}</a></p>
			<p><strong>Adresse : </strong>{{ entity.client.adresse }}</p>
			<p><strong>Localité : </strong>{{ entity.client.NPA }} {{ entity.client.Localite }}</p>
			<hr>
		{% endif %}
		<div class="btn-group">
		  <a href="{{ path('facture_print', { 'id': entity.id } ) }}?_format=pdf" target="_blank" class="btn btn-danger">Impression en PDF</a>
		  <button class="btn  btn-danger dropdown-toggle" data-toggle="dropdown">
		    <span class="caret"></span>
		  </button>
		  <ul class="dropdown-menu">
		    <li>
		    	<a href="{{ path('facture_print', { 'id': entity.id } ) }}?_format=html" >Impression en HTML</a>
		    </li>
		  </ul>
		</div>
		
		<h3>Articles : </h3>
		<table class="table table-bordered table-striped table-condensed">
			<thead>
				<tr>
					<th>Descriptif</th>
					<th>Quantité</th>
					<th>Unité</th>
					<th>Prix Unitaire</th>
					<th>Montant</th>
					{% if entity.editable  %}<th>Actions</th>{% endif %}
				</tr>
			</thead>
			<tbody>
			{% for article in entity.articles %}
				<tr>
					<td>{{ article.descriptif|raw }}</td>
					<td>{{ article.quantite }}</td>
					<td>{{ article.unite }}</td>
					<td class="text-right">{{ macro.monetaire(article.prixUnitaire) }} CHF</td>
					<td class="text-right">{{ macro.monetaire(article.calculPrixTotal) }} CHF</td>
					{% if entity.editable  %}<td><a href="{{ path('articlefacture_edit', { 'id': article.id }) }}">Modifier</a></td>{% endif %}
				</tr>
			{% endfor %}
			{% set colspan = 2 %}
				<tr>
					<td colspan="{{ colspan }}" rowspan="10"></td>
					<td colspan="2">Sous Total	: </td>
					<td class="text-right">{{ macro.monetaire(entity.CalculSommeTotale) }} CHF</td>
					<td rowspan="10" ></td>
				</tr>
				<tr>
					<td colspan="2" >TVA {{ entity.tVA*100 }}% : </td>
					<td class="text-right">{{ macro.monetaire(entity.CalculTVA) }} CHF</td>
				</tr>
				<tr>
					<td colspan="2">Total TTC : </td>
					<td class="text-right">{{ macro.monetaire(entity.CalculSommeTTCTotale) }} CHF</td>
				</tr>
				{% if entity.rabais > 0 %}
				<tr>
					<td colspan="2">Rabais {{ entity.rabais*100 }}% : </td>
					<td>-{{ macro.monetaire(entity.CalculRabais)  }} CHF</td>
				</tr>
				<tr>
					<td colspan="2">Montant Net : </td>
					<td class="text-right">{{ macro.monetaire(entity.CalculSommeMontantTotal) }} CHF</td>
				</tr>
				{% endif %}
				<tr>
					<td colspan="2">Montant Net 30 jours : </td>
					<td class="text-right">{{ macro.monetaire(entity.CalculSommeMontantArrondiTotal) }} CHF</td>
				</tr>
			</tbody>
		</table>
		{% if entity.editable  %}
			{{ render(controller("FMRFactureBundle:ArticleFacture:new", { 'id':entity.id } )) }}
			<a class="btn btn-small" href="{{ path('facture_article_multiple_edit', { 'id': entity.id }) }}">Editer tous les articles</a>
		{% endif %}
		
		</div>
		
		
		
		
			<div class="form-actions">
		<a class="btn" href="{{ path('facture') }}">
			Retour &agrave; la liste
		</a>
		<a class="btn btn-primary" href="{{ path('facture_edit', { 'id': entity.id }) }}">
			Editer
		</a>
		<a class="btn btn-danger" href="{{ path('facture_delete', { 'id': entity.id }) }}">
			Supprimer
		</a>
</div>

{% endblock %}
